!function(global,factory){"object"==typeof exports&&"undefined"!=typeof module?module.exports=factory():"function"==typeof define&&define.amd?define(factory):global.Perfundo=factory()}(this,function(){"use strict";function $(expr,con){return"string"==typeof expr?(con||document).querySelector(expr):expr||null}function $$(expr,con){return Array.prototype.slice.call((con||document).querySelectorAll(expr))}var Perfundo=function Perfundo(element,options){void 0===options&&(options={});var me=this,defaultOptions={disableHistory:!1,swipe:!0,classNames:{link:"perfundo__link",overlay:"perfundo__overlay",content:"perfundo__content",close:"perfundo__close",prev:"perfundo__prev",next:"perfundo__next",untarget:"perfundo__untarget",active:"is-active"}};if("string"==typeof element&&$$(element).length>1){var object=[];return $$(element).forEach(function(singleElement){object.push(new Perfundo(singleElement,options))}),object}if(this.element=$(element),this.options=options,!this.element)return{};if(this.configure(defaultOptions),$.bind($$("."+this.options.classNames.link,this.element),{click:function(e){me.options.disableHistory&&e.preventDefault(),me.open(this.getAttribute("href"))}}),$.bind(this.element,{click:function(e){var isCloseButton=e.target.classList.contains(me.options.classNames.close),isOverlay=e.target.classList.contains(me.options.classNames.overlay);(isCloseButton||isOverlay)&&(me.options.disableHistory&&e.preventDefault(),me.close())}}),this.options.swipe){var swipeDistanceX,swipeDistanceY,touchStartX=0,touchStartY=0,touchEndX=0,touchEndY=0;$.bind($$("."+this.options.classNames.content,this.element),{touchstart:function(e){touchStartX=e.changedTouches[0].clientX,touchStartY=e.changedTouches[0].clientY},touchend:function(e){touchEndX=e.changedTouches[0].clientX,touchEndY=e.changedTouches[0].clientY,swipeDistanceX=touchStartX-touchEndX,swipeDistanceY=touchStartY-touchEndY,Math.abs(swipeDistanceX)>=50&&Math.abs(swipeDistanceY)<=60&&(swipeDistanceX>50?me.next():me.prev()),touchStartX=0,touchStartY=0,touchEndX=0,touchEndY=0,swipeDistanceX=null,swipeDistanceY=null}})}};return Perfundo.prototype.open=function(overlayItem){this.close(),$(overlayItem).classList.add(this.options.classNames.active)},Perfundo.prototype.close=function(){var this$1=this;$$("."+this.options.classNames.overlay+"."+this.options.classNames.active,this.element).forEach(function(overlayItem){overlayItem.classList.remove(this$1.options.classNames.active)})},Perfundo.prototype.next=function(){var nextLink=$("."+this.options.classNames.next,this.element);nextLink&&nextLink.click()},Perfundo.prototype.prev=function(){var prevLink=$("."+this.options.classNames.prev,this.element);prevLink&&prevLink.click()},Perfundo.prototype.configure=function(defaultOptions){var this$1=this;Object.keys(defaultOptions).forEach(function(key){var initial=defaultOptions[key],attrValue=this$1.element.getAttribute("data-"+key.toLowerCase());"number"==typeof initial?this$1.options[key]=parseInt(attrValue,10):initial instanceof Function?this$1.options[key]=null:attrValue&&(this$1.options[key]=attrValue),this$1.options[key]||0===this$1.options[key]||(this$1.options[key]=key in this$1.options?this$1.options[key]:initial)})},$.bind=function(elements,o){if(elements){(elements.length?elements:[elements]).forEach(function(element){Object.keys(o).forEach(function(events){var callback=o[events];events.split(/\s+/).forEach(function(event){element.addEventListener(event,callback)})})})}},Perfundo});