!function(global,factory){"object"==typeof exports&&"undefined"!=typeof module?module.exports=factory():"function"==typeof define&&define.amd?define(factory):global.Perfundo=factory()}(this,function(){"use strict";function configure(element,userOptions,defaultOptions){return Object.keys(defaultOptions).reduce(function(options,key){var initial=defaultOptions[key],attrValue=element.getAttribute("data-"+key.toLowerCase());return options[key]=attrValue||userOptions[key]||initial,options},{})}function $(selector,context){return"string"==typeof selector?(context||document).querySelector(selector):selector||null}function $$(selector,context){return Array.prototype.slice.call((context||document).querySelectorAll(selector))}var defaultOptions={disableHistory:!1,swipe:!0,classNames:{link:"perfundo__link",overlay:"perfundo__overlay",content:"perfundo__content",close:"perfundo__close",prev:"perfundo__prev",next:"perfundo__next",untarget:"perfundo__untarget",active:"is-active"}};$.bind=function(elements,o){elements&&(elements.length?elements:[elements]).forEach(function(element){Object.keys(o).forEach(function(events){var callback=o[events];events.split(/\s+/).forEach(function(event){element.addEventListener(event,callback)})})})};var Perfundo=function Perfundo(selector,options){void 0===options&&(options={});var self=this;return"string"==typeof selector&&$$(selector).length>1?$$(selector).map(function(element){return new Perfundo(element,options)}):(self.element=$(selector),self.element?(self.options=configure(self.element,options,defaultOptions),void self.initEvents()):{})};return Perfundo.prototype.initEvents=function(){var self=this;$.bind($$("."+self.options.classNames.link,self.element),{click:function(e){self.options.disableHistory&&e.preventDefault(),self.open(this.getAttribute("href"))}}),$.bind(self.element,{click:function(e){var isCloseButton=e.target.classList.contains(self.options.classNames.close),isOverlay=e.target.classList.contains(self.options.classNames.overlay);(isCloseButton||isOverlay)&&(self.options.disableHistory&&e.preventDefault(),self.close())}}),self.options.swipe&&self.initSwipeEvents()},Perfundo.prototype.initSwipeEvents=function(){var swipeDistanceX,swipeDistanceY,self=this,touchStartX=0,touchStartY=0,touchEndX=0,touchEndY=0;$.bind($$("."+self.options.classNames.content,self.element),{touchstart:function(e){touchStartX=e.changedTouches[0].clientX,touchStartY=e.changedTouches[0].clientY},touchend:function(e){touchEndX=e.changedTouches[0].clientX,touchEndY=e.changedTouches[0].clientY,swipeDistanceX=touchStartX-touchEndX,swipeDistanceY=touchStartY-touchEndY,Math.abs(swipeDistanceX)>=50&&Math.abs(swipeDistanceY)<=60&&(swipeDistanceX>50?self.next():self.prev()),touchStartX=0,touchStartY=0,touchEndX=0,touchEndY=0,swipeDistanceX=null,swipeDistanceY=null}})},Perfundo.prototype.open=function(overlayItem){this.close(),$(overlayItem).classList.add(this.options.classNames.active)},Perfundo.prototype.close=function(){var this$1=this;$$("."+this.options.classNames.overlay+"."+this.options.classNames.active,this.element).forEach(function(overlayItem){overlayItem.classList.remove(this$1.options.classNames.active)})},Perfundo.prototype.next=function(){var nextLink=$("."+this.options.classNames.next,this.element);nextLink&&nextLink.click()},Perfundo.prototype.prev=function(){var prevLink=$("."+this.options.classNames.prev,this.element);prevLink&&prevLink.click()},Perfundo});